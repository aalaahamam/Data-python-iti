pipeline {
    agent any

    environment {
        PYTHON_EXE = 'C:\\Users\\AIS\\AppData\\Local\\Programs\\Python\\Python310\\python.exe' 
                      
    }

    stages {
        stage('Setup and Install Dependencies') {
            steps {
                echo "--- 1. Cleaning previous virtual environment (if any) ---"
                bat "if exist venv ( rmdir /s /q venv )"

                echo "--- 2. Setting up Python virtual environment ---"
                // Use the full path to python.exe defined in the environment block
                bat "\"${env.PYTHON_EXE}\" -m venv venv"
                
                echo "--- 3. Installing dependencies ---"
                bat "venv\\Scripts\\pip install --no-cache-dir -r requirements.txt"
            }
        }

        stage('Train and Evaluate') {
            steps {
                echo "--- 4. Running data loading and preprocessing ---"
                bat "venv\\Scripts\\python data_loading.py"
                
                echo "--- 5. Starting model training ---"
                bat "venv\\Scripts\\python model_training.py"

                echo "--- 6. Evaluating the trained model ---"
                bat "venv\\Scripts\\python model_evaluation.py"
            }
        }
    }

    post {
        always {
            echo "--- Archiving the trained model file ---"
            archiveArtifacts artifacts: 'model.pkl', fingerprint: true
            
            echo "--- Cleaning up workspace ---"
            cleanWs()
        }
    }
}

